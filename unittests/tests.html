<!doctype html>

<html>
<link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="bootstrap-theme.min.css" />
<link rel="stylesheet" type="text/css" href="style.css" />

<script src="jquery.js"></script>
<script src="bootstrap.min.js"></script>
<script src="dothtml.js"></script>

<body>
	<div class="container">
		<h1>Summary</h1>
		<div id="summary">Passed: <span id="summary-passed">0</span> Failed: <span id="summary-failed">0</span> Total: <span id="summary-total">0</span></div>
		<h1>Tests</h1>
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th>Test Description</th>
					<th>DOT Markup</th>
					<th>Expected</th>
					<th>Result</th>
					<th>Pass/Fail</th>
				</tr>
			</thead>
			<tbody id="tests">
				<tr>
					<td>$write</td>
					<td>DOT.h("PASS").$write("#test1");</td>
					<td>N/A</td>
					<td id="test1results">N/A</td>
					<td id="test1" class="pending">PENDING</td>
				</tr>
				<tr>
					<td>$append</td>
					<td>DOT.h("PASS").$append("#test2");</td>
					<td>N/A</td>
					<td id="test2results">N/A</td>
					<td id="test2" class="pending">PENDING</td>
				</tr>
				<tr>
					<td>writeToId</td>
					<td>DOT.h("PASS").writeToId("test3");</td>
					<td>N/A</td>
					<td id="test3results">N/A</td>
					<td id="test3" class="pending">PENDING</td>
				</tr>
				<tr>
					<td>appendToId</td>
					<td>DOT.h("PASS").appendToId("test4");</td>
					<td>N/A</td>
					<td id="test4results">N/A</td>
					<td id="test4" class="pending">PENDING</td>
				</tr>
			</tbody>
		</table>
	</div>
</body>
<script>
var totalTests = 0;
var testsPassed = 0;
var testsFailed = 0;

function updateScore(){
	$("#summary-passed").html(testsPassed);
	$("#summary-failed").html(testsFailed);
	$("#summary-total").html(totalTests);
}

$(function(){
	//MANUAL TESTING FOR APPEND/WRITE
	try {
		totalTests++;
		DOT.h("PASS").$write("#test1");
		if($("#test1").html() != "PASS") throw "Writing 'PASS' resulted in: " + $("#test1").html();
		$("#test1").removeClass("pending");
		$("#test1").addClass("pass");
		testsPassed++;
	}
	catch(err) {
		$("#test1results").html(err.message);
		$("#test1").removeClass("pending");
		$("#test1").addClass("fail");
		$("#test1").html("FAIL");
		testsFailed++;
	}
	updateScore();
	try {
		totalTests++;
		DOT.h("PASS").$append("#test2");
		if($("#test2").html() == "PENDINGPASS") $("#test2").html("PASS");
		else throw "Concatenating 'PENDING' + 'PASS' resulted in: " + $("#test2").html();
		$("#test2").removeClass("pending");
		$("#test2").addClass("pass");
		testsPassed++;
	}
	catch(err) {
		$("#test2results").html(err.message);
		$("#test2").removeClass("pending");
		$("#test2").addClass("fail");
		$("#test2").html("FAIL");
		testsFailed++;
	}
	updateScore();
	try {
		totalTests++;
		DOT.h("PASS").writeToId("test3");
		if($("#test3").html() != "PASS") throw "Writing 'PASS' resulted in: " + $("#test3").html();
		$("#test3").removeClass("pending");
		$("#test3").addClass("pass");
		testsPassed++;
	}
	catch(err) {
		$("#test3results").html(err.message);
		$("#test3").removeClass("pending");
		$("#test3").addClass("fail");
		$("#test3").html("FAIL");
		testsFailed++;
	}
	updateScore();
	try {
		totalTests++;
		DOT.h("PASS").appendToId("test4");
		if($("#test4").html() == "PENDINGPASS") $("#test4").html("PASS");
		else throw "Concatenating 'PENDING' + 'PASS' resulted in: " + $("#test4").html();
		$("#test4").removeClass("pending");
		$("#test4").addClass("pass");
		testsPassed++;
	}
	catch(err) {
		$("#test4results").html(err.message);
		$("#test4").removeClass("pending");
		$("#test4").addClass("fail");
		$("#test4").html("FAIL");
		testsFailed++;
	}
	updateScore();
	
	function addTest(description, test, expected, testTimeout){
		var resultHtml;
		try{
			var testResult = test();
		}
		catch(err){
			resultHtml = err.message;
			testTimeout = 0;
		}
		
		var testContents = test.toString();
		
		if(!testTimeout) testTimeout = 0;
		
		
		
		setTimeout(function(){
			if(!resultHtml) resultHtml = testResult._document ? testResult._document.innerHTML : "";
			DOT.tr(
				DOT.td(description)
				.td(DOT.t(testContents.slice(testContents.indexOf("return") + 7, testContents.lastIndexOf("}"))))
				.td(DOT.t(expected))
				.td(DOT.t(resultHtml))
				.td(resultHtml == expected ? "PASS" : "FAIL").class(resultHtml == expected ? "pass" : "fail")
			).$append("#tests");
			
			totalTests++;
			if(resultHtml == expected) testsPassed++;
			else testsFailed++;
			
			updateScore();
		}, testTimeout);
	}
	//Writing/Appending
	
	//Basic functionality
	addTest("Nothing", function(){ return DOT; }, "");
	addTest("Write text", function(){ return DOT.h(1); }, "1");
	addTest("Write 2 texts", function(){ return DOT.h(1).h(2); }, "12");
	addTest("Write HTML", function(){ return DOT.h("<div></div>"); }, "<div></div>");
	addTest("Escape HTML", function(){ return DOT.t("<div></div>"); }, "&lt;div&gt;&lt;/div&gt;");
	addTest("Div", function(){ return DOT.div(); }, "<div></div>");
	addTest("Number in a div", function(){ return DOT.div(1); }, "<div>1</div>");
	addTest("String in a div", function(){ return DOT.div("1"); }, "<div>1</div>");
	addTest("Boolean in a div", function(){ return DOT.div(true); }, "<div>true</div>");
	addTest("JSON object in a div", function(){ return DOT.div({}); }, "<div></div>");
	addTest("Function in a div", function(){ return DOT.div(function(){return DOT.h(1)}) }, "<div>1</div>");
	addTest("HTML in a div", function(){ return DOT.div("<div></div>"); }, "<div>&lt;div&gt;&lt;/div&gt;</div>");
	addTest("Nested content", function(){ return DOT.div(DOT.div(1)); }, "<div><div>1</div></div>");
	addTest("Side by side divs", function(){ return DOT.div().div(); }, "<div></div><div></div>");
	addTest("Side by side w/ content", function(){ return DOT.div(1).div(2); }, "<div>1</div><div>2</div>");
	addTest("Outside the box", function(){ return DOT.h(1).div(2).h(3); }, "1<div>2</div>3");
	addTest("Irregular nesting", function(){ 
		return DOT.h(1)
		.div(2)
		.h(3)
		.div(
			DOT.h(4)
			.div(5)
			.h(6)
			.div(DOT.div(7))
			.h(8)
		).h(9); }, "1<div>2</div>3<div>4<div>5</div>6<div><div>7</div></div>8</div>9");
	addTest("Class", function(){ return DOT.div().class(1); }, "<div class=\"1\"></div>");
	addTest("2nd class", function(){ return DOT.div().div().class(2).div(); }, "<div></div><div class=\"2\"></div><div></div>");
	addTest("Failing class", function(){ return DOT.h(1).class(2); }, "1");
	addTest("Wrong class", function(){ return DOT.div(DOT.class(1)); }, "<div></div>");
	addTest("Skipped class", function(){ return DOT.div().h(1).class(2); }, "<div></div>1");
	addTest("Missed class", function(){ return DOT.class(1); }, "");
	addTest("Void element", function(){ return DOT.img(); }, "<img>");
	addTest("Self-explaining attribute", function(){ return DOT.button().disabled(); }, "<button disabled=\"disabled\"></button>");
	//Ignore undefined (like functions that hane no return, etc).
	addTest("Undefined div", function(){ return DOT.div(undefined) }, "<div></div>");
	addTest("Undefined html", function(){ return DOT.h(undefined) }, "undefined"); //On the fence about this.
	addTest("Undefined text", function(){ return DOT.t(undefined) }, "undefined"); //If the user really wants to print out undefined.
	//Special tags.
	//...
	//If statements.
	addTest("Conditional true", function(){ return DOT.h(1).if(true, DOT.h("true")).h(2); }, "1true2");
	addTest("Conditional false", function(){ return DOT.h(1).if(false, DOT.h("false")).h(2); }, "12");
	addTest("Conditional true true", function(){ return DOT.h(1).if(true, DOT.h(2)).if(true, DOT.h(3)).h(4); }, "1234");
	//Logic.
	addTest("If true else", function(){ return DOT.if(true, "if").else("else"); }, "if");
	addTest("If false else", function(){ return DOT.if(false, "if").else("else"); }, "else");
	addTest("If false else else", function(){ return DOT.if(false, "if").else("else1").else("else2"); }, "else1else2");
	addTest("If true elseif true else", function(){ return DOT.if(true, "if").elseif(true, "elseif").else("else"); }, "if");
	addTest("If true elseif false else", function(){ return DOT.if(true, "if").elseif(false, "elseif").else("else"); }, "if");
	addTest("If false elseif true else", function(){ return DOT.if(false, "if").elseif(true, "elseif").else("else"); }, "elseif");
	addTest("If false elseif false else", function(){ return DOT.if(false, "if").elseif(false, "elseif").else("else"); }, "else");
	addTest("Nested ifs", function(){ 
	return DOT.if(true,
			DOT.if(false, "if if")
			.elseif(true, "if elseif")
			.else("if else")
		).elseif(true, "elseif")
		.else("else"); 
	}, "if elseif");
	//Truthiness
	addTest("If null", function(){ return DOT.if(null, "if").else("else"); }, "else");
	addTest("If {}", function(){ return DOT.if({}, "if").else("else"); }, "if");
	//Iterations
	addTest("Iterate", function(){ return DOT.iterate(3, function(i){return DOT.h(i)}); }, "012");
	addTest("Iterate w/ friends", function(){ return DOT.h("s").iterate(3, function(i){return DOT.h(i)}).h("f"); }, "s012f");
	addTest("Iterate no return", function(){ return DOT.h("s").iterate(3, function(i){DOT.h(i)}).h("f"); }, "sf");
	addTest("Iterate raw DOT", function(){ return DOT.h("s").iterate(3, DOT.h("-")).h("f"); }, "s---f");
	addTest("Iterate raw DOT HTML", function(){ return DOT.h("s").iterate(3, DOT.div()).h("f"); }, "s<div></div><div></div><div></div>f");
	addTest("Iterate text", function(){ return DOT.h("s").iterate(3, "-").h("f"); }, "s---f");
	addTest("Nested iterate", function(){ 
		return DOT.h("s")
		.iterate(2, function(i){
			return DOT.iterate(2, function(j){return j})
		}).h("f"); 
	}, "s0101f");
	addTest("Each", function(){ return DOT.each([0, 1, 2], function(x){return x}); }, "012");
	addTest("Nested each", function(){ return DOT.each([0, 1, 2], function(x){return DOT.h(x).each([3, 4, 5], function(y){return y})}); }, "034513452345");
	//Scripted
	addTest("Script, no return", function(){ return DOT.script(function(){1 + 1;}).div(1); }, "<div>1</div>");
	addTest("Script, return DOT", function(){ return DOT.script(function(){return 2;}).div(1); }, "2<div>1</div>");
	addTest("Script, return function", function(){ return DOT.script(function(){return function(){return 2};}).div(1); }, "2<div>1</div>");
	//Wait
	addTest("Wait, timing early (80ms)", function(){ return DOT.div(1).wait(100, DOT.div(3)).div(2); }, "<div>1</div><timeout></timeout><div>2</div>", 80);
	addTest("Wait, for nothing", function(){ return DOT.div(1).wait(100, function(){}).div(2); }, "<div>1</div><div>2</div>", 120);
	addTest("Wait, for a string", function(){ return DOT.div(1).wait(100, "3").div(2); }, "<div>1</div>3<div>2</div>", 120);
	addTest("Wait, for a div", function(){ return DOT.div(1).wait(100, DOT.div(3)).div(2); }, "<div>1</div><div>3</div><div>2</div>", 120);
	addTest("Wait, inside a div", function(){ return DOT.div(1).div(DOT.wait(100, DOT.div(3))).div(2); }, "<div>1</div><div><div>3</div></div><div>2</div>", 120);
	addTest("Wait, for class (not supported yet)", function(){ return DOT.div(1).wait(100, DOT.class(3)).div(2); }, "<div>1</div><div>2</div>", 120);
	addTest("Wait, for a function", function(){ return DOT.div(1).wait(100, function(){return DOT.div(3)}).div(2); }, "<div>1</div><div>3</div><div>2</div>", 120);
	addTest("Wait, append to nothing", function(){ return DOT.wait(100, DOT.div(3)); }, "<div>3</div>", 120);
	addTest("Wait, append to nothing, concat 2", function(){ return DOT.wait(100, DOT.div(3)).h(2); }, "<div>3</div>2", 120);
	addTest("Wait, append between text nodes", function(){ return DOT.h(1).wait(100, DOT.div(3)).h(2); }, "1<div>3</div>2", 120);
	addTest("Wait, out of order", function(){ return DOT.wait(100, DOT.div(1)).wait(200, DOT.div(2)).wait(50, DOT.div(3)); }, "<div>1</div><div>2</div><div>3</div>", 220);
	addTest("Wait, iterate", function(){ return DOT.div(1).wait(100, DOT.h("s").iterate(3, "-").h("f")).div(2); }, "<div>1</div>s---f<div>2</div>", 120);
	addTest("Waitception, early (220ms)", function(){ return DOT.wait(100, DOT.div(DOT.wait(300, DOT.div(1)))); }, "<div><timeout></timeout></div>", 220);
	addTest("Waitception, late (220ms), times shouldn't stack", function(){ return DOT.wait(200, DOT.div(DOT.wait(200, DOT.div(1)))); }, "<div><div>1</div></div>", 220);
	addTest("Waitception, late (320ms)", function(){ return DOT.wait(100, DOT.div(DOT.wait(200, DOT.div(1)))); }, "<div><div>1</div></div>", 320);
	addTest("Waitception, late (320ms), short inner interval", function(){ return DOT.wait(200, DOT.div(DOT.wait(100, DOT.div(1)))); }, "<div><div>1</div></div>", 320);
});
</script>
</html>