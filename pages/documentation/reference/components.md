# Components

## What is a Component?

A component is a function that encapsulates DOThtml and allows you to return and work with HTML in an organized way. You can think of it like a factory (not to be confused with the factory design pattern), which provides a means to extend the DOThtml library with custom, chainable functions that can generate markup (and more).

## Defining a Component

The component function allows you to define a component and accepts an argument consisting of a JSON object, which contains a `name` property, a `builder` function, and, *optionally*, a `ready` function.

Here is an example:

``` JavaScript
{
	name: "component_name",
	builder: function(){ /*…*/ },
	ready: function(){ /*…*/ }
}
```

The `name` property extends the dot namespace with a function that instantiates the component by calling the function assigned to the `builder` property (among a few other steps listed below).

The `builder` function should typically return DOThtml syntax (but can also return a string containing HTML). Whatever is returned by the `builder` function will be added to DOThtml's virtual document, which is eventually added to target element on the DOM.

The `ready` function (which is optional) is automatically executed after the markup generated by the component is placed on the DOM.

The execution context of both the `builder` and `ready` functions are scoped to a new empty object, which is created for each instantiation of the component. That is to say that the `this` keyword will refer to the internal object of each component's instance. Immediately after a compnent is instantiated, this internal object will be assigned a field named `element`, which references the last element that was created by the `builder` function.

> **_Note:_** In order to use the `this` keyword, avoid using arrow functions in your component's definition. You can access the `element` field from the `ready` function: `ready: function(){ this.element }`. However, the following will not work: `ready: () => { this.element }`.

## Instantiating a Component

After a component has been defined, it is possible to instantiate it the same way that any other element is created with DOThtml. The component's name with extend the `dot` namespace, and, when called as a function, passes all parameters into the `builder` function.

## Under the Hood

When a component is defined, the DOThtml namespace is extended (by the component) with a function of the specified name; this allows you to instantiate the component. However, there is more taking place under the hood than simply adding the builder function to the dot namespace.

When a component is instantiated, this internal function is executed and follows several steps:

1. It creates an empty object.
2. It calls the `builder` function scoped to the empty object and passes in all arguments.
3. It appends the DOThtml virtual document with what is returned by the `builder` function.
4. It sets the element field of the empty object to the last HTML element (or node) generated by the `builder` function.
5. If a `ready` function was provided in the component's definition, the ready function will be called after a 0 milisecond timeout and will be scoped to the empty object.
6. The current virtual document is returned.