# Components

Components extend the `dot` and VDBO namespaces with custom builder functions that generate custom markup in an organized way.

In a nutshell, components:

- Have a custom name that extends `dot` and VDBO namespaces.
- Have builder functions that return DOThtml syntax that gets rendered in-place.
- May have custom parameters or behaviors.
- Are always chainable like built-in DOThtml element and attribute functions (even if their builder function does not return a VDBO).
- Allow you to specify a `ready` function that is called after the component has been rendered to the ancestor VDBO (typically the DOM).

## Defining a Component

The `component` function allows you to define a component. 

!!!API!!!
component - Defines a component.
---
- dot.
---
name - The name of the component. This name with extend the <code>dot</code> and VDBO namespaces.
builder() - A function that gets called when the component is being instantiated. Arguments are whatever the user passes in during instantiation. Return value is processed as DOThtml syntax and added to the current virtual document. Scope of <code>this</code> will be 
ready() - <i>Optional</i> |  A function that is automatically executed after the markup generated by the component is placed on the virtual document (or DOM).
---
Nothing (is not chainable).
---

``` JavaScript
dot.component(
	"citation",
	function(text, link){ return dot.a(text).href(link).target("_blank"); },
	function(){ console.log("Component is created", this.element) }
);

dot("#citations").citation("My favorite website.", "https://dothtml.org");
```

For convenience, <code>component</code> can also be used with a single JSON argument, as follows:

``` JavaScript
dot.component({
	name: "component_name",
	builder: function(){ /*...*/ },
	ready: function(){ /*...*/ }
});
```
!!!/API!!!

It is illegal to declare a component with a name that already exists in the `dot` namespace or the VDBO. This includes other components. If you'd like to re-define a component that was previously defined, remove it first using the `removeComponent` function (described below).

The execution context of both the `builder` and `ready` functions are scoped to a new empty object, which is created for each instantiation of the component. That is to say that the `this` keyword will refer to the internal object of each component's instance. Immediately after a component is instantiated, this internal object will be assigned a field named `element`, which references the last element that was created by the `builder` function. The `element` object will be available in the `ready` function.

> **_Note:_** In order to use the `this` keyword, avoid using arrow functions in your component's definition. You can access the `element` field from the `ready` function: `ready: function(){ this.element }`. However, the following will not work: `ready: () => { this.element }`.

## Instantiating a Component

After a component has been defined, it is possible to instantiate it the same way that any other element is created with DOThtml. The component's name with extend the `dot` namespace, and, when called as a function, passes all parameters into the `builder` function.

## Removing a Component from DOThtml

Components can be removed from DOThtml using the `removeComponent` function.

!!!API!!!
removeComponent - Removes a previously-defined component from DOThtml.
---
- dot.
---
name - The name of the component to remove.
---
Nothing (is not chainable).
---
This will remove the built-in router component.

``` JavaScript
dot.removeComponent("router");
```
!!!/API!!!

> **_Note:_** Only components may be removed from DOThtml. `removeComponent` cannot be used to remove built-in elements, attributes, or other special functions.

## Under the Hood

When a component is defined, the `dot` namespace and the VDBO prototype is extended with a function of the specified name; this allows you to instantiate the component. However, there is more taking place under the hood than simply adding the builder function to the dot namespace.

When a component is instantiated, this internal function is executed and does several things:

1. Creates an empty object equal to `new function(){}`.
2. Calls the `builder` function scoped to the empty object and passes in all arguments.
3. Sets the `element` property of the empty object to whatever the last parent element returned was.
4. Appends the DOThtml virtual document with what is returned by the `builder` function.
5. Sets the element field of the empty object to the last HTML element (or node) generated by the `builder` function.
6. If a `ready` function was provided in the component's definition, the ready function will be called after a 0 millisecond timeout and will be scoped to the empty object. Note that in future versions of DOThtml, `ready` will be called without a timeout. This is a planned feature.
7. The `builder` function's VDBO is returned. If the `builder` function didn't return a VDBO, one will be created containing the rendered output of the `builder` function.